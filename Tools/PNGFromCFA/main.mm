#import <Cocoa/Cocoa.h>
#import <sys/stat.h>
#import <vector>
#import <string>
#import <filesystem>
#import <iostream>
#import <unordered_map>
#import "Mmap.h"
#import "Renderer.h"
#import "ImagePipelineTypes.h"
#import "DebayerLMMSE.h"
#import "Mat.h"
#import "Color.h"
using namespace CFAViewer;
namespace fs = std::filesystem;

struct CCM {
    double cct = 0;
    Mat<double,3,3> m; // CamRaw -> ProPhotoRGB
};

// Indoor, night
const CCM CCM1 = {
    .cct = 2700, // Guess for indoor lighting
    .m = {
        0.521344186662455,  0.113346231148492,  0.431813248502819,
        -0.317987185325044, 1.35991855224469,   0.00764589794909130,
        -0.156625495502160, -0.791837884750571, 2.95415429891511
    },
};

// Outdoor, 4pm
const CCM CCM2 = {
    .cct = 5503, // D55 (afternoon daylight)
    .m = {
         0.87821948648235, -0.174223734662964, 0.45442803351144,
        -0.02893173307590,  0.796387462849104, 0.31101923360413,
        -0.02996397397430, -0.622494750933791, 2.22133584775692,
    },
};

static Mat<double,3,3> CCMInterp(const CCM& lo, const CCM& hi, double cct) {
    const double k = ((1/cct) - (1/lo.cct)) / ((1/hi.cct) - (1/lo.cct));
    return lo.m*(1-k) + hi.m*k;
}

// Approximate CCT given xy chromaticity, using the Hernandez-Andres equation
static double CCTFromXYChromaticity(double x, double y) {
    const double xe[]   = { 0.3366,      0.3356     };
    const double ye[]   = { 0.1735,      0.1691     };
    const double A0[]   = { -949.86315,  36284.48953};
    const double A1[]   = { 6253.80338,  0.00228    };
    const double t1[]   = { 0.92159,     0.07861    };
    const double A2[]   = { 28.70599,    5.4535e-36 };
    const double t2[]   = { 0.20039,     0.01543    };
    const double A3[]   = { 0.00004,     0          };
    const double t3[]   = { 0.07125,     0.07125    };
    const double n[]    = {(x-xe[0])/(y-ye[0]), (x-xe[1])/(y-ye[1])};
    const double cct[]  = {
        A0[0] + A1[0]*exp(-n[0]/t1[0]) + A2[0]*exp(-n[0]/t2[0]) + A3[0]*exp(-n[0]/t3[0]),
        A0[1] + A1[1]*exp(-n[1]/t1[1]) + A2[1]*exp(-n[1]/t2[1]) + A3[1]*exp(-n[1]/t3[1]),
    };
    
    if (cct[0] <= 50000) return cct[0];
    else                 return cct[1];
}

static CCM CCMForIlluminant(const Color<ColorSpace::Raw>& illumRaw) {
    // Start out with a guess for the xy coordinates (D55 chromaticity)
    double x = 0.332424;
    double y = 0.347426;
    CCM ccm;
    
    // Iteratively estimate the xy chromaticity of `illumRaw`,
    // along with the CCT and interpolated CCM.
    constexpr int MaxIter = 50;
    for (int i=0; i<MaxIter; i++) {
        // Calculate CCT from current xy chromaticity estimate, and interpolate between
        // CCM1 and CCM2 based on that CCT
        CCM ccm2;
        ccm2.cct = std::clamp(CCTFromXYChromaticity(x,y), CCM1.cct, CCM2.cct);
        ccm2.m = CCMInterp(CCM1, CCM2, ccm2.cct);
        
        // Convert `illumRaw` to ProPhotoRGB coordinates using ccm2 (the new interpolated CCM)
        const Color<ColorSpace::ProPhotoRGB> illumRGB(ccm2.m * illumRaw.m);
        // Convert illumRGB to XYZ coordinates
        const Color<ColorSpace::XYZ<ColorSpace::ProPhotoRGB::White>> illumXYZ(illumRGB);
        
        constexpr double Eps = .01;
        const double x2 = illumXYZ[0]/(illumXYZ[0]+illumXYZ[1]+illumXYZ[2]);
        const double y2 = illumXYZ[1]/(illumXYZ[0]+illumXYZ[1]+illumXYZ[2]);
        const double Δx = std::abs((x-x2)/x);
        const double Δy = std::abs((y-y2)/y);
        const double Δcct = std::abs((ccm.cct-ccm2.cct)/ccm.cct);
        double Δccm = 0;
        for (int y=0; y<3; y++) {
            for (int x=0; x<3; x++) {
                Δccm = std::max(Δccm, std::abs((ccm.m.at(y,x)-ccm2.m.at(y,x))/ccm.m.at(y,x)));
            }
        }
        
        ccm = ccm2;
        x = x2;
        y = y2;
        
        if (Δx<Eps && Δy<Eps && Δcct<Eps && Δccm<Eps) return ccm;
    }
    
    throw std::runtime_error("didn't converge");
}

static simd::float3x3 SIMDFromMat(const Mat<double,3,3>& m) {
    return {
        simd::float3{(float)m.at(0,0), (float)m.at(1,0), (float)m.at(2,0)},
        simd::float3{(float)m.at(0,1), (float)m.at(1,1), (float)m.at(2,1)},
        simd::float3{(float)m.at(0,2), (float)m.at(1,2), (float)m.at(2,2)},
    };
}

static CGColorSpaceRef SRGBColorSpace() {
    static CGColorSpaceRef cs = CGColorSpaceCreateWithName(kCGColorSpaceSRGB);
    return cs;
}

static void writePNG(id<MTLTexture> txt, const fs::path& path) {
    const size_t ComponentsPerPixel = 4; // RGBA
    const size_t BytesPerComponent = 2; // 16-bit floats
    const size_t w = [txt width];
    const size_t h = [txt height];
    const size_t bytesPerRow = ComponentsPerPixel*BytesPerComponent*w;
    const uint32_t opts = kCGImageAlphaNoneSkipLast|kCGBitmapFloatComponents|kCGBitmapByteOrder16Little;
    id ctx = CFBridgingRelease(CGBitmapContextCreate(nullptr, w, h, BytesPerComponent*8, bytesPerRow,
        SRGBColorSpace(), opts));
    
    if (!ctx) throw std::runtime_error("CGBitmapContextCreate returned nil");
    
    uint8_t* data = (uint8_t*)CGBitmapContextGetData((CGContextRef)ctx);
    [txt getBytes:data bytesPerRow:bytesPerRow fromRegion:MTLRegionMake2D(0,0,w,h) mipmapLevel:0];
    
    id img = CFBridgingRelease(CGBitmapContextCreateImage((CGContextRef)ctx));
    if (!img) throw std::runtime_error("CGBitmapContextCreateImage returned nil");
    
    id imgDest = CFBridgingRelease(CGImageDestinationCreateWithURL(
        (CFURLRef)[NSURL fileURLWithPath:@(path.c_str())], kUTTypePNG, 1, nullptr));
    if (!imgDest) throw std::runtime_error("CGImageDestinationCreateWithURL returned nil");
    CGImageDestinationAddImage((CGImageDestinationRef)imgDest, (CGImageRef)img, nullptr);
    CGImageDestinationFinalize((CGImageDestinationRef)imgDest);
}

static void createPNGFromCFA(Renderer& renderer, uint32_t width, uint32_t height, const fs::path& path) {
    using namespace ImagePipeline;
    const CFADesc CFADesc = {CFAColor::Green, CFAColor::Red, CFAColor::Blue, CFAColor::Green};
    
    const std::unordered_map<std::string,Color<ColorSpace::Raw>> C50Illuminants = {
        { "indoor_night_1", { 0.49315425753593445, 0.6456764936447144, 0.5830100774765015 } },
        { "indoor_night_2", { 0.4718649387359619, 0.6506156921386719, 0.5950148105621338 } },
        { "indoor_night_3", { 0.6015027165412903, 0.6915735006332397, 0.3999008536338806 } },
        { "indoor_night_4", { 0.5988341569900513, 0.691754937171936, 0.40357497334480286 } },
        { "indoor_night_5", { 0.5615782141685486, 0.6827187538146973, 0.4674665927886963 } },
        { "indoor_night_6", { 0.5701081156730652, 0.6810783743858337, 0.4594660997390747 } },
        { "indoor_night_7", { 0.6259804368019104, 0.6917587518692017, 0.3600254952907562 } },
        { "indoor_night_8", { 0.635915219783783, 0.689150333404541, 0.3473955988883972 } },
        { "indoor_night_9", { 0.47666069865226746, 0.6500223875045776, 0.591832160949707 } },
        { "indoor_night_10", { 0.504420816898346, 0.6635997295379639, 0.552444577217102 } },
        { "indoor_night_11", { 0.509157121181488, 0.6653949618339539, 0.5459015369415283 } },
        { "indoor_night_12", { 0.47313010692596436, 0.651683509349823, 0.5928377509117126 } },
        { "indoor_night_13", { 0.5753155946731567, 0.6783888339996338, 0.45694705843925476 } },
        { "indoor_night_14", { 0.5988783240318298, 0.6946263313293457, 0.39854615926742554 } },
        { "indoor_night_15", { 0.5818448662757874, 0.6918612122535706, 0.4275331497192383 } },
        { "indoor_night_16", { 0.5634962320327759, 0.6858121752738953, 0.46057966351509094 } },
        { "indoor_night_17", { 0.5951157212257385, 0.6941099762916565, 0.4050290882587433 } },
        { "indoor_night_18", { 0.600875735282898, 0.6955738067626953, 0.39385971426963806 } },
        { "indoor_night_19", { 0.5955843329429626, 0.6948654055595398, 0.4030402898788452 } },
        { "indoor_night_20", { 0.5745306015014648, 0.6897940039634705, 0.44056645035743713 } },
        { "indoor_night_21", { 0.5745386481285095, 0.6918662190437317, 0.4372946321964264 } },
        { "indoor_night_22", { 0.633021891117096, 0.692909836769104, 0.34519460797309875 } },
        { "indoor_night_23", { 0.610343337059021, 0.6928585767745972, 0.3839634358882904 } },
        { "indoor_night_24", { 0.5954671502113342, 0.6924530863761902, 0.4073420464992523 } },
        { "indoor_night_25", { 0.5516604781150818, 0.6829907298088074, 0.4787425100803375 } },
        { "indoor_night_26", { 0.5861709117889404, 0.6896237134933472, 0.4252326190471649 } },
        { "indoor_night_27", { 0.5907546281814575, 0.6925959587097168, 0.4139080047607422 } },
        { "indoor_night_28", { 0.5791062712669373, 0.6892880201339722, 0.43533673882484436 } },
        { "indoor_night_29", { 0.5707054138183594, 0.6907799243927002, 0.44398021697998047 } },
        { "indoor_night_30", { 0.5907261371612549, 0.6955229640007019, 0.4090115427970886 } },
        { "indoor_night_31", { 0.5440348982810974, 0.6754084825515747, 0.4978446662425995 } },
        { "indoor_night_32", { 0.6263936758041382, 0.6889227628707886, 0.3647141456604004 } },
        { "indoor_night_33", { 0.5789435505867004, 0.6912704706192017, 0.4323996305465698 } },
        { "indoor_night_34", { 0.6153914928436279, 0.6944586634635925, 0.37285447120666504 } },
        { "indoor_night_35", { 0.5974767208099365, 0.6945700645446777, 0.40074172616004944 } },
        { "indoor_night_36", { 0.6119657754898071, 0.694912850856781, 0.37761613726615906 } },
        { "indoor_night_37", { 0.5838047862052917, 0.6903010606765747, 0.42738333344459534 } },
        { "indoor_night_38", { 0.6036392450332642, 0.6921656727790833, 0.39563387632369995 } },
        { "indoor_night_39", { 0.5918990969657898, 0.6904683113098145, 0.41582322120666504 } },
        { "indoor_night_40", { 0.5961012840270996, 0.6916398406028748, 0.40779581665992737 } },
        { "indoor_night_41", { 0.6060185432434082, 0.6933629512786865, 0.38985809683799744 } },
        { "indoor_night_42", { 0.6170715093612671, 0.6939540505409241, 0.3710126578807831 } },
        { "indoor_night_43", { 0.6166778206825256, 0.6935091018676758, 0.3724963366985321 } },
        { "indoor_night_44", { 0.5980878472328186, 0.6935607194900513, 0.4015772342681885 } },
        { "indoor_night_45", { 0.6129533052444458, 0.6937587857246399, 0.3781363070011139 } },
        { "indoor_night_46", { 0.6137135028839111, 0.6926135420799255, 0.3790018856525421 } },
        { "indoor_night_47", { 0.6152953505516052, 0.6928304433822632, 0.37602880597114563 } },
        { "indoor_night_48", { 0.6195763945579529, 0.694044291973114, 0.3666437268257141 } },
        { "indoor_night_49", { 0.6095123887062073, 0.6949241161346436, 0.3815431594848633 } },
        { "indoor_night_50", { 0.6103075742721558, 0.6945915222167969, 0.38087719678878784 } },
        { "indoor_night_51", { 0.6267493367195129, 0.6946919560432434, 0.3529708981513977 } },
        { "indoor_night_52", { 0.6208432912826538, 0.6940824389457703, 0.3644217550754547 } },
        { "indoor_night_53", { 0.6310996413230896, 0.6986203789710999, 0.33710941672325134 } },
        { "indoor_night_54", { 0.640906810760498, 0.6965304613113403, 0.32262033224105835 } },
        { "indoor_night_55", { 0.6468840837478638, 0.6960482001304626, 0.3115411400794983 } },
        { "indoor_night_56", { 0.6358815431594849, 0.697002649307251, 0.3314242362976074 } },
        { "indoor_night_57", { 0.6340153813362122, 0.6969423294067383, 0.3351058065891266 } },
        { "indoor_night_58", { 0.6439228057861328, 0.6960064172744751, 0.31770825386047363 } },
        { "indoor_night_59", { 0.644158124923706, 0.6975119113922119, 0.31390678882598877 } },
        { "indoor_night_60", { 0.6359107494354248, 0.6973332166671753, 0.3306719660758972 } },
        { "indoor_night_61", { 0.6416109204292297, 0.6965050101280212, 0.32127296924591064 } },
        { "indoor_night_62", { 0.6437569260597229, 0.6967778205871582, 0.31635043025016785 } },
        { "indoor_night_63", { 0.6324154138565063, 0.6966656446456909, 0.33868518471717834 } },
        { "indoor_night_64", { 0.6346740126609802, 0.6969138383865356, 0.33391618728637695 } },
        { "indoor_night_65", { 0.6260303854942322, 0.6956737637519836, 0.35231244564056396 } },
        { "indoor_night_66", { 0.6391003727912903, 0.6959354877471924, 0.32745158672332764 } },
        { "indoor_night_67", { 0.6233079433441162, 0.6958202123641968, 0.35682132840156555 } },
        { "indoor_night_68", { 0.6401692628860474, 0.696869432926178, 0.3233518898487091 } },
        { "indoor_night_69", { 0.6393108367919922, 0.6965216994285583, 0.32579001784324646 } },
        { "indoor_night_70", { 0.6463373303413391, 0.6971805095672607, 0.31014084815979004 } },
        { "indoor_night_71", { 0.5941756367683411, 0.6942841410636902, 0.40610939264297485 } },
        { "indoor_night_72", { 0.6226910352706909, 0.696693480014801, 0.3561941087245941 } },
        { "indoor_night_73", { 0.6429190039634705, 0.6977070569992065, 0.31600624322891235 } },
        { "indoor_night_74", { 0.6414669752120972, 0.6952996850013733, 0.3241581618785858 } },
        { "indoor_night_75", { 0.6458208560943604, 0.6954669952392578, 0.3150254786014557 } },
        { "indoor_night_76", { 0.6489893198013306, 0.6965510845184326, 0.3059893250465393 } },
        { "indoor_night_77", { 0.6416780352592468, 0.6957022547721863, 0.32287389039993286 } },
        { "indoor_night_78", { 0.642317533493042, 0.6964794397354126, 0.3199132978916168 } },
        { "indoor_night_79", { 0.6459450125694275, 0.6966000199317932, 0.3122555613517761 } },
        { "indoor_night_80", { 0.645390510559082, 0.6964391469955444, 0.3137570917606354 } },
        { "indoor_night_81", { 0.6446143984794617, 0.6954267024993896, 0.31757521629333496 } },
        { "indoor_night_82", { 0.6460069417953491, 0.696336567401886, 0.3127146363258362 } },
        { "indoor_night_83", { 0.6379145383834839, 0.6961368322372437, 0.3293306827545166 } },
        { "indoor_night_84", { 0.6440680027008057, 0.6964688301086426, 0.31639763712882996 } },
        { "indoor_night_85", { 0.6443161368370056, 0.6962438225746155, 0.31638777256011963 } },
        { "indoor_night_86", { 0.6352145671844482, 0.6959125399589539, 0.33497488498687744 } },
        { "indoor_night_87", { 0.6344534754753113, 0.6966133117675781, 0.3349607586860657 } },
        { "indoor_night_88", { 0.6256964206695557, 0.6963921785354614, 0.35148534178733826 } },
        { "indoor_night_89", { 0.6245562434196472, 0.6966158747673035, 0.35306617617607117 } },
        { "indoor_night_90", { 0.5398873090744019, 0.6824926733970642, 0.4926716983318329 } },
        { "indoor_night_91", { 0.5094984173774719, 0.6609845757484436, 0.5509181618690491 } },
        { "indoor_night_92", { 0.5150038599967957, 0.6549410820007324, 0.5530127882957458 } },
        { "indoor_night_93", { 0.5952387452125549, 0.6920562386512756, 0.4083491563796997 } },
        { "indoor_night_94", { 0.5497615933418274, 0.6716707348823547, 0.4966092109680176 } },
        { "indoor_night_95", { 0.5202436447143555, 0.6759824156761169, 0.5219141840934753 } },
        { "indoor_night_96", { 0.591731071472168, 0.6901988387107849, 0.4165092706680298 } },
        { "indoor_night_97", { 0.5857897996902466, 0.6967765092849731, 0.41394785046577454 } },
        { "indoor_night_98", { 0.5870799422264099, 0.6945203542709351, 0.41590699553489685 } },
        { "indoor_night_99", { 0.604609489440918, 0.6934495568275452, 0.3918865919113159 } },
        { "indoor_night_100", { 0.6123578548431396, 0.6944624185562134, 0.37780922651290894 } },
        { "indoor_night_101", { 0.6334512233734131, 0.6965934038162231, 0.3368934392929077 } },
        { "indoor_night_102", { 0.5240169763565063, 0.6785188913345337, 0.514799177646637 } },
        { "indoor_night_103", { 0.5886543393135071, 0.6951804161071777, 0.4125654697418213 } },
        { "indoor_night_104", { 0.611396074295044, 0.695613443851471, 0.3772489130496979 } },
        { "indoor_night_105", { 0.6044372916221619, 0.6954488158226013, 0.38859549164772034 } },
        { "indoor_night_106", { 0.6206424236297607, 0.6953361630439758, 0.362368106842041 } },
        { "indoor_night_107", { 0.6216338872909546, 0.6968457698822021, 0.3577391803264618 } },
        { "indoor_night_108", { 0.6186140775680542, 0.6971855759620667, 0.36228296160697937 } },
        { "indoor_night_109", { 0.6216735243797302, 0.6974209547042847, 0.356547474861145 } },
        { "indoor_night_110", { 0.6214140057563782, 0.6967044472694397, 0.3583957254886627 } },
        { "indoor_night_111", { 0.6245044469833374, 0.6966133117675781, 0.35316288471221924 } },
        { "indoor_night_112", { 0.585067093372345, 0.6959410905838013, 0.4163683354854584 } },
        { "indoor_night_113", { 0.4688373804092407, 0.6409025192260742, 0.6078121066093445 } },
        { "indoor_night_114", { 0.48226073384284973, 0.6577516198158264, 0.5786080360412598 } },
        { "indoor_night_115", { 0.5681682825088501, 0.6893539428710938, 0.449417382478714 } },
        { "indoor_night_116", { 0.5582581758499146, 0.6847233772277832, 0.4685100317001343 } },
        { "indoor_night_117", { 0.6082603931427002, 0.6937750577926636, 0.38561034202575684 } },
        { "indoor_night_118", { 0.5576820969581604, 0.6740174293518066, 0.4844492971897125 } },
        { "indoor_night_119", { 0.5950820446014404, 0.6913090944290161, 0.40984034538269043 } },
        { "indoor_night_120", { 0.5268884301185608, 0.6748144030570984, 0.5167340040206909 } },
        { "indoor_night_121", { 0.5683108568191528, 0.6887811422348022, 0.4501146376132965 } },
        { "indoor_night_122", { 0.5239337682723999, 0.6719978451728821, 0.523366391658783 } },
        { "indoor_night_123", { 0.5602865219116211, 0.6878002285957336, 0.4615299701690674 } },
        { "indoor_night_124", { 0.566954493522644, 0.6871606707572937, 0.4542827308177948 } },
        { "indoor_night_125", { 0.5494834780693054, 0.6827670335769653, 0.4815569818019867 } },
        { "indoor_night_126", { 0.5623182058334351, 0.6860935091972351, 0.4615994095802307 } },
        { "indoor_night_127", { 0.5604902505874634, 0.689357340335846, 0.4589522182941437 } },
        { "indoor_night_128", { 0.5692941546440125, 0.6919304132461548, 0.4440004229545593 } },
        { "indoor_night_129", { 0.5236659646034241, 0.6759654879570007, 0.5185022354125977 } },
        { "indoor_night_130", { 0.5028363466262817, 0.6620001792907715, 0.5557979345321655 } },
        { "indoor_night_131", { 0.5649859309196472, 0.6847395896911621, 0.4603504240512848 } },
        { "indoor_night_132", { 0.48216232657432556, 0.6620851755142212, 0.5737270712852478 } },
        { "indoor_night_133", { 0.551842451095581, 0.6804308891296387, 0.48216554522514343 } },
        { "indoor_night_134", { 0.598957896232605, 0.6985195875167847, 0.3915606439113617 } },
        { "indoor_night_135", { 0.5400860905647278, 0.6769986748695374, 0.49997982382774353 } },
        { "indoor_night_136", { 0.5567160844802856, 0.6837380528450012, 0.47177261114120483 } },
        { "indoor_night_137", { 0.5245653986930847, 0.675144612789154, 0.5186626315116882 } },
        { "indoor_night_138", { 0.5372180938720703, 0.6793567538261414, 0.4998711049556732 } },
        { "indoor_night_139", { 0.5471075773239136, 0.6847558617591858, 0.48143813014030457 } },
        { "indoor_night_140", { 0.5654237270355225, 0.6852544546127319, 0.45904508233070374 } },
        { "indoor_night_141", { 0.48395830392837524, 0.6551567316055298, 0.5801327228546143 } },
        { "indoor_night_142", { 0.5887189507484436, 0.6899810433387756, 0.4211130738258362 } },
        { "indoor_night_143", { 0.616875946521759, 0.6931973695755005, 0.37274840474128723 } },
        { "indoor_night_144", { 0.6185451149940491, 0.6964940428733826, 0.3637278378009796 } },
        { "indoor_night_145", { 0.5596988201141357, 0.6897010803222656, 0.45940136909484863 } },
        { "indoor_night_146", { 0.5869975686073303, 0.6933611631393433, 0.4179523289203644 } },
        { "indoor_night_147", { 0.5936605930328369, 0.697871744632721, 0.4006770849227905 } },
        { "indoor_night_148", { 0.6148110628128052, 0.6965810656547546, 0.3698408007621765 } },
        { "indoor_night_149", { 0.5822741389274597, 0.6966381669044495, 0.41910868883132935 } },
        { "indoor_night_150", { 0.6075924634933472, 0.6997725367546082, 0.37569910287857056 } },
        { "indoor_night_151", { 0.6080933809280396, 0.6982263922691345, 0.37775951623916626 } },
        { "indoor_night_152", { 0.617060661315918, 0.698146402835846, 0.3630809187889099 } },
        { "indoor_night_153", { 0.5748723149299622, 0.6842031478881836, 0.44876253604888916 } },
        { "indoor_night_154", { 0.5202572345733643, 0.6601786613464355, 0.5417532324790955 } },
        { "indoor_night_155", { 0.550682783126831, 0.68378084897995, 0.47874030470848083 } },
        { "indoor_night_156", { 0.6040554642677307, 0.6928220391273499, 0.3938460052013397 } },
        { "indoor_night_157", { 0.6218519806861877, 0.6927329301834106, 0.36526867747306824 } },
        { "indoor_night_158", { 0.6274230480194092, 0.6927376389503479, 0.3556048274040222 } },
        { "indoor_night_159", { 0.6247887015342712, 0.6930181980133057, 0.35967329144477844 } },
        { "indoor_night_160", { 0.6162147521972656, 0.6940013766288757, 0.3723459243774414 } },
        { "indoor_night_161", { 0.611391007900238, 0.6931912302970886, 0.3816893994808197 } },
        { "indoor_night_162", { 0.6226636171340942, 0.6924278140068054, 0.36446356773376465 } },
        { "indoor_night_163", { 0.6218249797821045, 0.6914578676223755, 0.3677224814891815 } },
        { "indoor_night_164", { 0.6190265417098999, 0.6925193667411804, 0.37043648958206177 } },
        { "indoor_night_165", { 0.633503794670105, 0.6898913979530334, 0.3503180742263794 } },
        { "indoor_night_166", { 0.6313552856445312, 0.691877007484436, 0.35028085112571716 } },
        { "indoor_night_167", { 0.6155290603637695, 0.6923952698707581, 0.37644752860069275 } },
        { "indoor_night_168", { 0.6333019137382507, 0.692980945110321, 0.3445374071598053 } },
        { "indoor_night_169", { 0.6157232522964478, 0.6941629648208618, 0.37285739183425903 } },
        { "indoor_night_170", { 0.5916067361831665, 0.6933392286300659, 0.4114392399787903 } },
        { "indoor_night_171", { 0.6124183535575867, 0.6959165930747986, 0.37502506375312805 } },
        { "indoor_night_172", { 0.6103309392929077, 0.6960137486457825, 0.37823405861854553 } },
        { "indoor_night_173", { 0.602641224861145, 0.6948844194412231, 0.3923763930797577 } },
        { "indoor_night_174", { 0.5820441246032715, 0.6921976804733276, 0.42671653628349304 } },
        { "indoor_night_175", { 0.5956284999847412, 0.6943812966346741, 0.4038083851337433 } },
        { "indoor_night_176", { 0.5930284261703491, 0.6938492059707642, 0.4085223376750946 } },
        { "indoor_night_177", { 0.5720240473747253, 0.6895310878753662, 0.44422447681427 } },
        { "indoor_night_178", { 0.5370317697525024, 0.6653876900672913, 0.5185133218765259 } },
        { "indoor_night_179", { 0.5511728525161743, 0.6863468885421753, 0.4744855463504791 } },
        { "indoor_night_180", { 0.6424747705459595, 0.6970100402832031, 0.31843870878219604 } },
        { "indoor_night_181", { 0.5711377263069153, 0.6855942010879517, 0.45140042901039124 } },
        { "indoor_night_182", { 0.4830995500087738, 0.6495769023895264, 0.5870814919471741 } },
        { "indoor_night_183", { 0.539337158203125, 0.6736913323402405, 0.5052279829978943 } },
        { "indoor_night_184", { 0.5939534902572632, 0.6859530806541443, 0.4203423261642456 } },
        { "indoor_night_185", { 0.6101328730583191, 0.688478946685791, 0.3920900523662567 } },
        { "outdoor_4pm_1", { 0.4727637767791748, 0.6748706102371216, 0.5666075348854065 } },
        { "outdoor_4pm_2", { 0.46761554479599, 0.6760861873626709, 0.5694234371185303 } },
        { "outdoor_4pm_3", { 0.46603715419769287, 0.6905310153961182, 0.5531513094902039 } },
        { "outdoor_4pm_4", { 0.46756675839424133, 0.6831200122833252, 0.561006486415863 } },
        { "outdoor_4pm_5", { 0.47691354155540466, 0.6863183379173279, 0.5491089224815369 } },
        { "outdoor_4pm_6", { 0.4759320616722107, 0.689689040184021, 0.5457266569137573 } },
        { "outdoor_4pm_7", { 0.4748602509498596, 0.69230717420578, 0.5433401465415955 } },
        { "outdoor_4pm_8", { 0.4743320643901825, 0.6893473267555237, 0.5475484728813171 } },
        { "outdoor_4pm_9", { 0.4757704436779022, 0.6876328587532043, 0.5484555959701538 } },
        { "outdoor_4pm_10", { 0.4747371971607208, 0.6892760992050171, 0.5472870469093323 } },
        { "outdoor_4pm_11", { 0.47598594427108765, 0.6909286975860596, 0.5441092848777771 } },
        { "outdoor_4pm_12", { 0.4745143949985504, 0.6881328225135803, 0.5489165186882019 } },
        { "outdoor_4pm_13", { 0.4739573895931244, 0.6885160207748413, 0.5489172339439392 } },
        { "outdoor_4pm_14", { 0.47614455223083496, 0.6926004886627197, 0.5418402552604675 } },
        { "outdoor_4pm_15", { 0.47390252351760864, 0.686723530292511, 0.5512052774429321 } },
        { "outdoor_4pm_16", { 0.4762703776359558, 0.6878814697265625, 0.5477094054222107 } },
        { "outdoor_4pm_17", { 0.4840588867664337, 0.6298657059669495, 0.6074177026748657 } },
        { "outdoor_4pm_18", { 0.48579761385917664, 0.6709626913070679, 0.5601872801780701 } },
        { "outdoor_4pm_19", { 0.49119895696640015, 0.6854466199874878, 0.5374816656112671 } },
        { "outdoor_4pm_20", { 0.4765242338180542, 0.6863738298416138, 0.5493775010108948 } },
        { "outdoor_4pm_21", { 0.46324780583381653, 0.6830055117607117, 0.5647165775299072 } },
        { "outdoor_4pm_22", { 0.4579569399356842, 0.6619434356689453, 0.5933855175971985 } },
        { "outdoor_4pm_23", { 0.4780133068561554, 0.6875433921813965, 0.5466144680976868 } },
        { "outdoor_4pm_24", { 0.47460275888442993, 0.6704512238502502, 0.5703046917915344 } },
        { "outdoor_4pm_25", { 0.4765892028808594, 0.6761828660964966, 0.56181800365448 } },
        { "outdoor_4pm_26", { 0.40394049882888794, 0.6400434374809265, 0.6535873413085938 } },
        { "outdoor_4pm_27", { 0.5007647275924683, 0.6977533102035522, 0.5122255086898804 } },
        { "outdoor_4pm_28", { 0.4744460880756378, 0.6515477299690247, 0.5919344425201416 } },
        { "outdoor_4pm_29", { 0.5209251046180725, 0.719441831111908, 0.4593915045261383 } },
        { "outdoor_4pm_30", { 0.4431339204311371, 0.6462101936340332, 0.621324896812439 } },
        { "outdoor_4pm_31", { 0.49006205797195435, 0.689248263835907, 0.5336440801620483 } },
        { "outdoor_4pm_32", { 0.49773311614990234, 0.6932692527770996, 0.5211904048919678 } },
        { "outdoor_4pm_33", { 0.47522783279418945, 0.6710111498832703, 0.5691243410110474 } },
        { "outdoor_4pm_34", { 0.4878928065299988, 0.6769610047340393, 0.5510756373405457 } },
        { "outdoor_4pm_35", { 0.48928549885749817, 0.6774169206619263, 0.5492777228355408 } },
        { "outdoor_4pm_36", { 0.4930499494075775, 0.6863830089569092, 0.5345840454101562 } },
        { "outdoor_4pm_37", { 0.465170681476593, 0.6496580839157104, 0.6012991070747375 } },
        { "outdoor_4pm_38", { 0.4674566388130188, 0.6570510864257812, 0.5914120078086853 } },
        { "outdoor_4pm_39", { 0.4665132164955139, 0.6622971892356873, 0.5862830877304077 } },
        { "outdoor_4pm_40", { 0.4307786226272583, 0.6474008560180664, 0.6287304162979126 } },
        { "outdoor_4pm_41", { 0.43951770663261414, 0.6515147686004639, 0.6183468103408813 } },
        { "outdoor_4pm_42", { 0.42715755105018616, 0.6427150368690491, 0.6359668374061584 } },
        { "outdoor_4pm_43", { 0.4726703464984894, 0.6380483508110046, 0.607846200466156 } },
        { "outdoor_4pm_44", { 0.4339333176612854, 0.6395130157470703, 0.6346062421798706 } },
        { "outdoor_4pm_45", { 0.47910648584365845, 0.6447815895080566, 0.5955783724784851 } },
        { "outdoor_4pm_46", { 0.4510679543018341, 0.6576982736587524, 0.6032997965812683 } },
        { "outdoor_4pm_47", { 0.47954583168029785, 0.6660764217376709, 0.5712950229644775 } },
        { "outdoor_4pm_48", { 0.48161792755126953, 0.6425991058349609, 0.5959115624427795 } },
        { "outdoor_4pm_49", { 0.49047547578811646, 0.652864396572113, 0.5772364139556885 } },
        { "outdoor_4pm_50", { 0.46668878197669983, 0.6450724601745605, 0.6050480008125305 } },
        { "outdoor_4pm_51", { 0.48901745676994324, 0.6116076707839966, 0.6219308376312256 } },
        { "outdoor_4pm_52", { 0.5208691954612732, 0.6979314088821411, 0.4915149509906769 } },
        { "outdoor_4pm_53", { 0.4848345220088959, 0.645691454410553, 0.5899307131767273 } },
        { "outdoor_4pm_54", { 0.4973950982093811, 0.6140511631965637, 0.6128126978874207 } },
        { "outdoor_4pm_55", { 0.4826619625091553, 0.6434363722801208, 0.5941608548164368 } },
        { "outdoor_4pm_56", { 0.4955955445766449, 0.6738888621330261, 0.5479587912559509 } },
        { "outdoor_4pm_57", { 0.49009087681770325, 0.6260043382644653, 0.6065720319747925 } },
        { "outdoor_4pm_58", { 0.46589386463165283, 0.6480275392532349, 0.6024974584579468 } },
        { "outdoor_4pm_59", { 0.470729261636734, 0.6541081666946411, 0.5920780897140503 } },
        { "outdoor_4pm_60", { 0.44901302456855774, 0.6458863615989685, 0.6174286007881165 } },
        { "outdoor_4pm_61", { 0.4730970859527588, 0.6383497714996338, 0.6071973443031311 } },
        { "outdoor_4pm_62", { 0.4692241847515106, 0.6418167352676392, 0.6065475940704346 } },
        { "outdoor_4pm_63", { 0.48711690306663513, 0.6814554929733276, 0.5462009906768799 } },
        { "outdoor_4pm_64", { 0.477929949760437, 0.6840012073516846, 0.5511127710342407 } },
        { "outdoor_4pm_65", { 0.49156659841537476, 0.6859481334686279, 0.536504864692688 } },
        { "outdoor_4pm_66", { 0.4948292374610901, 0.6950927376747131, 0.5215268135070801 } },
        { "outdoor_4pm_67", { 0.48677635192871094, 0.6850962042808533, 0.5419334769248962 } },
        { "outdoor_4pm_68", { 0.4867854416370392, 0.6830976605415344, 0.5444424748420715 } },
        { "outdoor_4pm_69", { 0.48458361625671387, 0.6811633706092834, 0.5488125085830688 } },
        { "outdoor_4pm_70", { 0.49171820282936096, 0.6808056235313416, 0.5428783893585205 } },
        { "outdoor_4pm_71", { 0.4760151505470276, 0.6742485761642456, 0.5646224021911621 } },
        { "outdoor_4pm_72", { 0.47971194982528687, 0.6828390955924988, 0.5510056018829346 } },
        { "outdoor_4pm_73", { 0.46074455976486206, 0.6675196290016174, 0.5849205255508423 } },
        { "outdoor_4pm_74", { 0.4697889983654022, 0.653815507888794, 0.5931471586227417 } },
        { "outdoor_4pm_75", { 0.472271591424942, 0.643976628780365, 0.6018751859664917 } },
        { "outdoor_4pm_76", { 0.4862844944000244, 0.655698299407959, 0.5775700211524963 } },
        { "outdoor_4pm_77", { 0.4793030321598053, 0.6618584394454956, 0.576378345489502 } },
        { "outdoor_4pm_78", { 0.5108988881111145, 0.6979110836982727, 0.5018988251686096 } },
        { "outdoor_4pm_79", { 0.4864717423915863, 0.673029363155365, 0.5571146607398987 } },
        { "outdoor_4pm_80", { 0.48835015296936035, 0.6563196778297424, 0.5751162171363831 } },
        { "outdoor_4pm_81", { 0.47992074489593506, 0.6538830995559692, 0.5849043130874634 } },
        { "outdoor_4pm_82", { 0.4808969795703888, 0.6514784097671509, 0.5867827534675598 } },
        { "outdoor_4pm_83", { 0.47860872745513916, 0.6480241417884827, 0.5924511551856995 } },
        { "outdoor_4pm_84", { 0.4751742482185364, 0.6463311314582825, 0.5970474481582642 } },
        { "outdoor_4pm_85", { 0.4874904155731201, 0.6644681096076965, 0.5664232969284058 } },
        { "outdoor_4pm_86", { 0.47706878185272217, 0.6583251953125, 0.5822485685348511 } },
        { "outdoor_4pm_87", { 0.4812907576560974, 0.6572601199150085, 0.5799726843833923 } },
        { "outdoor_4pm_88", { 0.4686559736728668, 0.6527277231216431, 0.5952377915382385 } },
        { "outdoor_4pm_89", { 0.463042289018631, 0.658189594745636, 0.5936145782470703 } },
        { "outdoor_4pm_90", { 0.46641266345977783, 0.6556475162506104, 0.5937891602516174 } },
        { "outdoor_4pm_91", { 0.46115362644195557, 0.6553744077682495, 0.5981820225715637 } },
        { "outdoor_4pm_92", { 0.47604304552078247, 0.6498712301254272, 0.5924951434135437 } },
        { "outdoor_4pm_93", { 0.47396349906921387, 0.6513274908065796, 0.5925631523132324 } },
        { "outdoor_4pm_94", { 0.46612173318862915, 0.6492791175842285, 0.6009717583656311 } },
        { "outdoor_4pm_95", { 0.4743417203426361, 0.6553846001625061, 0.5877677798271179 } },
        { "outdoor_4pm_96", { 0.4688463509082794, 0.6542462110519409, 0.5934181213378906 } },
        { "outdoor_4pm_97", { 0.4509970545768738, 0.6538341641426086, 0.6075380444526672 } },
        { "outdoor_4pm_98", { 0.46346917748451233, 0.6522881984710693, 0.5997636318206787 } },
        { "outdoor_4pm_99", { 0.45920100808143616, 0.6500566005706787, 0.6054427027702332 } },
        { "outdoor_4pm_100", { 0.45241498947143555, 0.6510775089263916, 0.609441339969635 } },
        { "outdoor_4pm_101", { 0.46344128251075745, 0.6535465121269226, 0.5984137654304504 } },
        { "outdoor_4pm_102", { 0.4636894762516022, 0.6533253192901611, 0.5984631776809692 } },
        { "outdoor_4pm_103", { 0.4612739086151123, 0.6459575891494751, 0.6082475185394287 } },
        { "outdoor_4pm_104", { 0.4789237976074219, 0.659636378288269, 0.5792338848114014 } },
        { "outdoor_4pm_105", { 0.4778114855289459, 0.6640817523002625, 0.5750579237937927 } },
        { "outdoor_4pm_106", { 0.4649573862552643, 0.6543993353843689, 0.5963020920753479 } },
        { "outdoor_4pm_107", { 0.4584183692932129, 0.653133749961853, 0.6027178764343262 } },
        { "outdoor_4pm_108", { 0.47047024965286255, 0.6515579223632812, 0.5950883030891418 } },
        { "outdoor_4pm_109", { 0.46023738384246826, 0.6603076457977295, 0.5934436321258545 } },
        { "outdoor_4pm_110", { 0.4631226360797882, 0.659670352935791, 0.5919057130813599 } },
        { "outdoor_4pm_111", { 0.46694204211235046, 0.6660878658294678, 0.5816288590431213 } },
        { "outdoor_4pm_112", { 0.4716697633266449, 0.6652162075042725, 0.5788049101829529 } },
        { "outdoor_4pm_113", { 0.46894317865371704, 0.6614317297935486, 0.5853207111358643 } },
        { "outdoor_4pm_114", { 0.45662757754325867, 0.6645076274871826, 0.591541051864624 } },
        { "outdoor_4pm_115", { 0.4615064263343811, 0.6597940325737, 0.593029260635376 } },
        { "outdoor_4pm_116", { 0.45837533473968506, 0.6575188636779785, 0.5979640483856201 } },
        { "outdoor_4pm_117", { 0.4590977132320404, 0.6477164626121521, 0.6080236434936523 } },
        { "outdoor_4pm_118", { 0.4614655673503876, 0.6540170311927795, 0.5994258522987366 } },
        { "outdoor_4pm_119", { 0.46245163679122925, 0.6570383310317993, 0.5953478217124939 } },
        { "outdoor_4pm_120", { 0.4711119532585144, 0.6555263996124268, 0.5902022123336792 } },
        { "outdoor_4pm_121", { 0.4563426971435547, 0.6566851139068604, 0.600429892539978 } },
        { "outdoor_4pm_122", { 0.4657951295375824, 0.6519039273262024, 0.5983779430389404 } },
        { "outdoor_4pm_123", { 0.4564514756202698, 0.6676116585731506, 0.588172435760498 } },
        { "outdoor_4pm_124", { 0.4576359987258911, 0.6626700162887573, 0.5928218364715576 } },
        { "outdoor_4pm_125", { 0.46069249510765076, 0.6562346816062927, 0.5975938439369202 } },
        { "outdoor_4pm_126", { 0.47006601095199585, 0.6588165163993835, 0.5873659253120422 } },
        { "outdoor_4pm_127", { 0.4602987766265869, 0.6550391316413879, 0.599206805229187 } },
        { "outdoor_4pm_128", { 0.47347015142440796, 0.6589266061782837, 0.5845012664794922 } },
        { "outdoor_4pm_129", { 0.4797514081001282, 0.6553928852081299, 0.5833513736724854 } },
        { "outdoor_4pm_130", { 0.47808435559272766, 0.6525669097900391, 0.5878704786300659 } },
        { "outdoor_4pm_131", { 0.4826279878616333, 0.6538519263267517, 0.5827074646949768 } },
        { "outdoor_4pm_132", { 0.48793718218803406, 0.6593431234359741, 0.5719999670982361 } },
        { "outdoor_4pm_133", { 0.4886610209941864, 0.6563326120376587, 0.574837327003479 } },
        { "outdoor_4pm_134", { 0.49295955896377563, 0.648940920829773, 0.579539954662323 } },
        { "outdoor_4pm_135", { 0.48328447341918945, 0.6482707858085632, 0.5883714556694031 } },
        { "outdoor_4pm_136", { 0.4776609539985657, 0.6575103998184204, 0.5826834440231323 } },
        { "outdoor_4pm_137", { 0.47410282492637634, 0.6546428799629211, 0.5887861847877502 } },
        { "outdoor_4pm_138", { 0.45167362689971924, 0.6482548713684082, 0.6129898428916931 } },
        { "outdoor_4pm_139", { 0.4669455587863922, 0.6540622115135193, 0.5951171517372131 } },
        { "outdoor_4pm_140", { 0.46807122230529785, 0.6579055786132812, 0.5899742245674133 } },
        { "outdoor_4pm_141", { 0.4708731472492218, 0.6567370295524597, 0.5890458226203918 } },
        { "outdoor_4pm_142", { 0.4804428517818451, 0.6634137034416199, 0.5736349821090698 } },
        { "outdoor_4pm_143", { 0.4580633342266083, 0.6490263938903809, 0.6074065566062927 } },
        { "outdoor_4pm_144", { 0.47372615337371826, 0.6497042179107666, 0.594531774520874 } },
        { "outdoor_4pm_145", { 0.4414314925670624, 0.6471655368804932, 0.6215425133705139 } },
        { "outdoor_4pm_146", { 0.4312353730201721, 0.6444765329360962, 0.6314159631729126 } },
        { "outdoor_4pm_147", { 0.44298362731933594, 0.6464890241622925, 0.6211420297622681 } },
        { "outdoor_4pm_148", { 0.4433959722518921, 0.6469777822494507, 0.6203383803367615 } },
        { "outdoor_4pm_149", { 0.45846205949783325, 0.6474409699440002, 0.6087961792945862 } },
        { "outdoor_4pm_150", { 0.465999573469162, 0.6473454236984253, 0.6031485795974731 } },
        { "outdoor_4pm_151", { 0.4592021703720093, 0.6487358212471008, 0.6068567633628845 } },
        { "outdoor_4pm_152", { 0.44497233629226685, 0.6549490690231323, 0.6107710599899292 } },
        { "outdoor_4pm_153", { 0.4590557813644409, 0.6527159810066223, 0.6026853322982788 } },
        { "outdoor_4pm_154", { 0.46595901250839233, 0.6523227691650391, 0.5977936387062073 } },
        { "outdoor_4pm_155", { 0.5065464973449707, 0.6885213255882263, 0.5189884305000305 } },
        { "outdoor_4pm_156", { 0.4960005283355713, 0.6884086728096008, 0.5292230248451233 } },
        { "outdoor_4pm_157", { 0.47015929222106934, 0.6631624102592468, 0.5823794603347778 } },
        { "outdoor_4pm_158", { 0.4867303669452667, 0.6766142249107361, 0.5525276064872742 } },
        { "outdoor_4pm_159", { 0.4883500933647156, 0.6721747517585754, 0.5565027594566345 } },
        { "outdoor_4pm_160", { 0.4753645360469818, 0.6624436974525452, 0.578961968421936 } },
        { "outdoor_4pm_161", { 0.4738513231277466, 0.6505440473556519, 0.5935127139091492 } },
        { "outdoor_4pm_162", { 0.45656171441078186, 0.6871801018714905, 0.5650972127914429 } },
        { "outdoor_4pm_163", { 0.47084978222846985, 0.6578642725944519, 0.5878053307533264 } },
        { "outdoor_4pm_164", { 0.465977281332016, 0.65230792760849, 0.5977956652641296 } },
        { "outdoor_4pm_165", { 0.5000046491622925, 0.7249067425727844, 0.47382020950317383 } },
        { "outdoor_4pm_166", { 0.46873342990875244, 0.6703990697860718, 0.5751991271972656 } },
        { "outdoor_4pm_167", { 0.4890223443508148, 0.6874099373817444, 0.5369586944580078 } },
        { "outdoor_4pm_168", { 0.4911070466041565, 0.6896886229515076, 0.5321123003959656 } },
        { "outdoor_4pm_169", { 0.4748363494873047, 0.6926359534263611, 0.5429419875144958 } },
        { "outdoor_4pm_170", { 0.4721547067165375, 0.673380434513092, 0.5688836574554443 } },
        { "outdoor_4pm_171", { 0.48423656821250916, 0.68836510181427, 0.540063202381134 } },
        { "outdoor_4pm_172", { 0.4752160906791687, 0.6762991547584534, 0.5628402829170227 } },
        { "outdoor_4pm_173", { 0.4719087481498718, 0.6660162806510925, 0.5776888728141785 } },
        { "outdoor_4pm_174", { 0.47462666034698486, 0.6585911512374878, 0.5839411020278931 } },
        { "outdoor_noon_1", { 0.47079843282699585, 0.6670836210250854, 0.5773631930351257 } },
        { "outdoor_noon_2", { 0.47244471311569214, 0.6644822359085083, 0.5790159106254578 } },
        { "outdoor_noon_3", { 0.47024184465408325, 0.6690948009490967, 0.5754866003990173 } },
        { "outdoor_noon_4", { 0.4727794826030731, 0.6664201617240906, 0.5765100121498108 } },
        { "outdoor_noon_5", { 0.47872522473335266, 0.6373868584632874, 0.6037880778312683 } },
        { "outdoor_noon_6", { 0.4840608537197113, 0.6696149110794067, 0.5632947087287903 } },
        { "outdoor_noon_7", { 0.45481282472610474, 0.6441773772239685, 0.6149640679359436 } },
        { "outdoor_noon_8", { 0.46031132340431213, 0.6556060314178467, 0.5985769033432007 } },
        { "outdoor_noon_9", { 0.46202975511550903, 0.6550737023353577, 0.5978351831436157 } },
        { "outdoor_noon_10", { 0.47205719351768494, 0.6613011956214905, 0.5829603672027588 } },
        { "outdoor_noon_11", { 0.46421897411346436, 0.6540496945381165, 0.5972602367401123 } },
        { "outdoor_noon_12", { 0.46476244926452637, 0.6536487936973572, 0.5972764492034912 } },
        { "outdoor_noon_13", { 0.48751378059387207, 0.6886373162269592, 0.5367578268051147 } },
        { "outdoor_noon_14", { 0.46612510085105896, 0.6538799405097961, 0.5959601402282715 } },
        { "outdoor_noon_15", { 0.47700223326683044, 0.6678397059440613, 0.5713658332824707 } },
        { "outdoor_noon_16", { 0.46888482570648193, 0.663791835308075, 0.5826897621154785 } },
        { "outdoor_noon_17", { 0.4554276168346405, 0.6584200263023376, 0.5992234349250793 } },
        { "outdoor_noon_18", { 0.4728221595287323, 0.6590871214866638, 0.584844708442688 } },
        { "outdoor_noon_19", { 0.4857262670993805, 0.6677900552749634, 0.5640268325805664 } },
        { "outdoor_noon_20", { 0.47973161935806274, 0.6785346865653992, 0.5562806725502014 } },
        { "outdoor_noon_21", { 0.4490114450454712, 0.6477299928665161, 0.6154953837394714 } },
        { "outdoor_noon_22", { 0.461121141910553, 0.6569458246231079, 0.5964809656143188 } },
        { "outdoor_noon_23", { 0.4609717130661011, 0.6546683311462402, 0.5990946888923645 } },
        { "outdoor_noon_24", { 0.4792582392692566, 0.6656823754310608, 0.571995198726654 } },
        { "outdoor_noon_25", { 0.4454972445964813, 0.6476860642433167, 0.6180897355079651 } },
        { "outdoor_noon_26", { 0.4529609978199005, 0.643750786781311, 0.6167749166488647 } },
        { "outdoor_noon_27", { 0.4484119415283203, 0.6444457769393921, 0.6193676590919495 } },
        { "outdoor_noon_28", { 0.4633549749851227, 0.6574791669845581, 0.5941575765609741 } },
        { "outdoor_noon_29", { 0.484650582075119, 0.6748069524765015, 0.5565513968467712 } },
        { "outdoor_noon_30", { 0.4749632775783539, 0.6646870970726013, 0.5767157077789307 } },
        { "outdoor_noon_31", { 0.5036908388137817, 0.69435715675354, 0.5139684677124023 } },
        { "outdoor_noon_32", { 0.49235814809799194, 0.6832413673400879, 0.5392259955406189 } },
        { "outdoor_noon_33", { 0.49378544092178345, 0.6821097731590271, 0.5393534898757935 } },
        { "outdoor_noon_34", { 0.48539069294929504, 0.6683229207992554, 0.5636847019195557 } },
        { "outdoor_noon_35", { 0.4780096411705017, 0.674451470375061, 0.5626918077468872 } },
        { "outdoor_noon_36", { 0.4946664571762085, 0.6830622553825378, 0.5373368263244629 } },
        { "outdoor_noon_37", { 0.49273672699928284, 0.6722140908241272, 0.552574634552002 } },
        { "outdoor_noon_38", { 0.49147510528564453, 0.6780765652656555, 0.5465019345283508 } },
        { "outdoor_noon_39", { 0.49460041522979736, 0.6806478500366211, 0.5404525399208069 } },
        { "outdoor_noon_40", { 0.47939324378967285, 0.6642653346061707, 0.5735273957252502 } },
        { "outdoor_noon_41", { 0.47940272092819214, 0.667732298374176, 0.5694791674613953 } },
        { "outdoor_noon_42", { 0.4911237359046936, 0.6869728565216064, 0.5355985760688782 } },
        { "outdoor_noon_43", { 0.48178884387016296, 0.6531056761741638, 0.5842368006706238 } },
        { "outdoor_noon_44", { 0.5173500180244446, 0.7093623280525208, 0.4787004292011261 } },
        { "outdoor_noon_45", { 0.5001705884933472, 0.6983073353767395, 0.512050986289978 } },
        { "outdoor_noon_46", { 0.5167365074157715, 0.6926769018173218, 0.5031721591949463 } },
        { "outdoor_noon_47", { 0.5295683145523071, 0.7165394425392151, 0.4540138244628906 } },
        { "outdoor_noon_48", { 0.5418003797531128, 0.7158786058425903, 0.44042038917541504 } },
        { "outdoor_noon_49", { 0.4962661564350128, 0.6921626329421997, 0.5240522027015686 } },
        { "outdoor_noon_50", { 0.48517388105392456, 0.6766716241836548, 0.553824782371521 } },
        { "outdoor_noon_51", { 0.48043206334114075, 0.6723614931106567, 0.5631296038627625 } },
        { "outdoor_noon_52", { 0.4487787187099457, 0.6540175080299377, 0.6089816689491272 } },
        { "outdoor_noon_53", { 0.4441221058368683, 0.6509551405906677, 0.6156401634216309 } },
        { "outdoor_noon_54", { 0.48297378420829773, 0.6731352210044861, 0.5600225925445557 } },
        { "outdoor_noon_55", { 0.461454302072525, 0.6523853540420532, 0.6012098789215088 } },
        { "outdoor_noon_56", { 0.4820564389228821, 0.6882337927818298, 0.5421768426895142 } },
        { "outdoor_noon_57", { 0.5224642157554626, 0.7052070498466492, 0.4792851209640503 } },
        { "outdoor_noon_58", { 0.5314882397651672, 0.7177189588546753, 0.4498884975910187 } },
        { "outdoor_noon_59", { 0.4886586368083954, 0.6757699251174927, 0.5518585443496704 } },
        { "outdoor_noon_60", { 0.47697073221206665, 0.6630439162254333, 0.5769502520561218 } },
        { "outdoor_noon_61", { 0.4644922912120819, 0.650827944278717, 0.6005579829216003 } },
        { "outdoor_noon_62", { 0.461503803730011, 0.6469651460647583, 0.6070011258125305 } },
        { "outdoor_noon_63", { 0.4639383852481842, 0.6466391682624817, 0.6054906249046326 } },
        { "outdoor_noon_64", { 0.4622010588645935, 0.6552496552467346, 0.5975099205970764 } },
        { "outdoor_noon_65", { 0.4546341896057129, 0.6613041758537292, 0.5966443419456482 } },
        { "outdoor_noon_66", { 0.4639497697353363, 0.6715473532676697, 0.577732503414154 } },
        { "outdoor_noon_67", { 0.47011494636535645, 0.6622452735900879, 0.5834578275680542 } },
        { "outdoor_noon_68", { 0.4926875829696655, 0.6798520088195801, 0.5431944131851196 } },
        { "outdoor_noon_69", { 0.4888572096824646, 0.6769007444381714, 0.5502945780754089 } },
        { "outdoor_noon_70", { 0.43015721440315247, 0.6343244910240173, 0.6423372030258179 } },
        { "outdoor_noon_71", { 0.4423311650753021, 0.6323160529136658, 0.6360185146331787 } },
        { "outdoor_noon_72", { 0.4625861346721649, 0.6544181704521179, 0.598122775554657 } },
        { "outdoor_noon_73", { 0.4587439000606537, 0.6541160345077515, 0.6014036536216736 } },
        { "outdoor_noon_74", { 0.47232240438461304, 0.6616947650909424, 0.5822985768318176 } },
        { "outdoor_noon_75", { 0.49042975902557373, 0.6843398809432983, 0.5395902395248413 } },
        { "outdoor_noon_76", { 0.5169634819030762, 0.7040729522705078, 0.4868573248386383 } },
        { "outdoor_noon_77", { 0.4804937243461609, 0.6747403144836426, 0.5602242350578308 } },
        { "outdoor_noon_78", { 0.4897163212299347, 0.6924909949302673, 0.5297490954399109 } },
        { "outdoor_noon_79", { 0.4863217771053314, 0.6709648966789246, 0.5597296357154846 } },
        { "outdoor_noon_80", { 0.46158528327941895, 0.6596332788467407, 0.5931467413902283 } },
        { "outdoor_noon_81", { 0.46178138256073, 0.6479989290237427, 0.6056858897209167 } },
        { "outdoor_noon_82", { 0.47860467433929443, 0.6758881211280823, 0.560457706451416 } },
        { "outdoor_noon_83", { 0.45746469497680664, 0.6525301337242126, 0.6040947437286377 } },
        { "outdoor_noon_84", { 0.48258864879608154, 0.6647671461105347, 0.5702568888664246 } },
        { "outdoor_noon_85", { 0.4768461287021637, 0.6661641597747803, 0.5734484791755676 } },
        { "outdoor_noon_86", { 0.4703153669834137, 0.67352694272995, 0.5702322721481323 } },
        { "outdoor_noon_87", { 0.47161468863487244, 0.6757264733314514, 0.5665450692176819 } },
        { "outdoor_noon_88", { 0.47297096252441406, 0.684751033782959, 0.5544498562812805 } },
        { "outdoor_noon_89", { 0.4629577696323395, 0.6682066917419434, 0.5823829174041748 } },
        { "outdoor_noon_90", { 0.4678530991077423, 0.687095046043396, 0.5558902025222778 } },
        { "outdoor_noon_91", { 0.4818013310432434, 0.6819757223129272, 0.5502514243125916 } },
        { "outdoor_noon_92", { 0.4806629717350006, 0.6766460537910461, 0.5577751994132996 } },
        { "outdoor_noon_93", { 0.4819851815700531, 0.6652579307556152, 0.5701948404312134 } },
        { "outdoor_noon_94", { 0.49844759702682495, 0.6966353058815002, 0.5159934759140015 } },
        { "outdoor_noon_95", { 0.46365073323249817, 0.6588586568832397, 0.5923961997032166 } },
        { "outdoor_noon_96", { 0.4813894033432007, 0.6643096208572388, 0.5718015432357788 } },
        { "outdoor_noon_97", { 0.4814070761203766, 0.6683027744293213, 0.5671142935752869 } },
        { "outdoor_noon_98", { 0.46662625670433044, 0.6621272563934326, 0.5863851308822632 } },
        { "outdoor_noon_99", { 0.4749537408351898, 0.6639139652252197, 0.5776132941246033 } },
        { "outdoor_noon_100", { 0.45644134283065796, 0.6530336141586304, 0.6043248176574707 } },
        { "outdoor_noon_101", { 0.46655747294425964, 0.6641831994056702, 0.5841102600097656 } },
        { "outdoor_noon_102", { 0.4740194082260132, 0.6609933972358704, 0.5817158818244934 } },
        { "outdoor_noon_103", { 0.4676395654678345, 0.657995343208313, 0.5902164578437805 } },
        { "outdoor_noon_104", { 0.46783527731895447, 0.6626771688461304, 0.5847984552383423 } },
        { "outdoor_noon_105", { 0.4807441532611847, 0.6699523329734802, 0.5657286643981934 } },
        { "outdoor_noon_106", { 0.4635234475135803, 0.6546896696090698, 0.5970991849899292 } },
        { "outdoor_noon_107", { 0.4769556522369385, 0.6752035021781921, 0.5626842975616455 } },
        { "outdoor_noon_108", { 0.5100773572921753, 0.6990959048271179, 0.5010848641395569 } },
        { "outdoor_noon_109", { 0.48052164912223816, 0.661182165145874, 0.5761398673057556 } },
        { "outdoor_noon_110", { 0.4635024964809418, 0.6511500477790833, 0.60097336769104 } },
        { "outdoor_noon_111", { 0.4772782623767853, 0.6628586053848267, 0.5769090056419373 } },
        { "outdoor_noon_112", { 0.49646490812301636, 0.6844109296798706, 0.5339515805244446 } },
        { "outdoor_noon_113", { 0.48949339985847473, 0.6648396253585815, 0.5642557144165039 } },
        { "outdoor_noon_114", { 0.48085975646972656, 0.6593354344367981, 0.5779711604118347 } },
        { "outdoor_noon_115", { 0.5016342401504517, 0.689693033695221, 0.5221939086914062 } },
        { "outdoor_noon_116", { 0.4944726526737213, 0.6774002909660339, 0.5446335077285767 } },
        { "outdoor_noon_117", { 0.5023930668830872, 0.6917303800582886, 0.5187584161758423 } },
        { "outdoor_noon_118", { 0.5076659917831421, 0.6931195855140686, 0.5117231607437134 } },
        { "outdoor_noon_119", { 0.5085610747337341, 0.6950898766517639, 0.508149266242981 } },
        { "outdoor_noon_120", { 0.49648308753967285, 0.6819746494293213, 0.5370427966117859 } },
        { "outdoor_noon_121", { 0.4716503918170929, 0.64364093542099, 0.6027207374572754 } },
        { "outdoor_noon_122", { 0.49354663491249084, 0.6886577606201172, 0.5311893820762634 } },
        { "outdoor_noon_123", { 0.5121983289718628, 0.6947578191757202, 0.5049400925636292 } },
        { "outdoor_noon_124", { 0.5023991465568542, 0.6854807734489441, 0.5269830226898193 } },
        { "outdoor_noon_125", { 0.4943157434463501, 0.6798908114433289, 0.5416644811630249 } },
        { "outdoor_noon_126", { 0.49650150537490845, 0.6727586984634399, 0.5485271215438843 } },
        { "outdoor_noon_127", { 0.4687210023403168, 0.6537296175956726, 0.5940861105918884 } },
        { "outdoor_noon_128", { 0.46537157893180847, 0.6537599563598633, 0.5966801047325134 } },
        { "outdoor_noon_129", { 0.45939403772354126, 0.6603519916534424, 0.5940474271774292 } },
        { "outdoor_noon_130", { 0.4641265869140625, 0.6599925756454468, 0.5907589793205261 } },
        { "outdoor_noon_131", { 0.4728112518787384, 0.6563746929168701, 0.5878961086273193 } },
        { "outdoor_noon_132", { 0.4576803743839264, 0.6490142345428467, 0.6077081561088562 } },
        { "outdoor_noon_133", { 0.46507856249809265, 0.6559627056121826, 0.5944871306419373 } },
        { "outdoor_noon_134", { 0.46577832102775574, 0.6623735427856445, 0.5867809653282166 } },
        { "outdoor_noon_135", { 0.466805100440979, 0.6636896729469299, 0.5844732522964478 } },
        { "outdoor_noon_136", { 0.47548842430114746, 0.6782846450805664, 0.5602149367332458 } },
        { "outdoor_noon_137", { 0.4952995777130127, 0.6794975399971008, 0.5412590503692627 } },
        { "outdoor_noon_138", { 0.47656697034835815, 0.6772485971450806, 0.5605517029762268 } },
        { "outdoor_noon_139", { 0.4602695107460022, 0.6428871154785156, 0.6122485399246216 } },
        { "outdoor_noon_140", { 0.46759676933288574, 0.6826162338256836, 0.5615944266319275 } },
        { "outdoor_noon_141", { 0.48193174600601196, 0.6605813503265381, 0.5756509900093079 } },
        { "outdoor_noon_142", { 0.48275598883628845, 0.6663497090339661, 0.5682647228240967 } },
        { "outdoor_noon_143", { 0.48749274015426636, 0.6749500036239624, 0.5538892149925232 } },
        { "outdoor_noon_144", { 0.4567762315273285, 0.6541529893875122, 0.6028592586517334 } },
        { "outdoor_noon_145", { 0.45989376306533813, 0.6425750851631165, 0.6128580570220947 } },
        { "outdoor_noon_146", { 0.45934489369392395, 0.649472713470459, 0.6059598922729492 } },
        { "outdoor_noon_147", { 0.47385475039482117, 0.6671711802482605, 0.574755847454071 } },
        { "outdoor_noon_148", { 0.4776878356933594, 0.6823143362998962, 0.5534089803695679 } },
        { "outdoor_noon_149", { 0.48175671696662903, 0.6844056248664856, 0.5472654104232788 } },
        { "outdoor_noon_150", { 0.49941369891166687, 0.6333872675895691, 0.5911062955856323 } },
        { "outdoor_noon_151", { 0.47540590167045593, 0.676941990852356, 0.5619063377380371 } },
        { "outdoor_noon_152", { 0.4867538809776306, 0.7066494226455688, 0.5135340690612793 } },
        { "outdoor_noon_153", { 0.4808990955352783, 0.6963051557540894, 0.5328181982040405 } },
        { "outdoor_noon_154", { 0.500121533870697, 0.7183887958526611, 0.48352453112602234 } },
        { "outdoor_noon_155", { 0.4812503457069397, 0.6659719944000244, 0.5699819922447205 } },
        { "outdoor_noon_156", { 0.47246217727661133, 0.656624972820282, 0.5878972411155701 } },
        { "outdoor_noon_157", { 0.4781464636325836, 0.6785715818405151, 0.5575989484786987 } },
        { "outdoor_noon_158", { 0.4801735579967499, 0.6622223854064941, 0.5752346515655518 } },
        { "outdoor_noon_159", { 0.47167670726776123, 0.6817485094070435, 0.5592316389083862 } },
        { "outdoor_noon_160", { 0.466413289308548, 0.6602100729942322, 0.5887115597724915 } },
        { "outdoor_noon_161", { 0.4651964604854584, 0.6878269910812378, 0.5572129487991333 } },
        { "outdoor_noon_162", { 0.46588361263275146, 0.6724112629890442, 0.5751656293869019 } },
        { "outdoor_noon_163", { 0.4674333930015564, 0.6557871699333191, 0.592831552028656 } },
        { "outdoor_noon_164", { 0.47883856296539307, 0.6722970008850098, 0.5645621418952942 } },
        { "outdoor_noon_165", { 0.46655863523483276, 0.6455984711647034, 0.6045870184898376 } },
        { "outdoor_noon_166", { 0.46606507897377014, 0.6699797511100769, 0.5778498649597168 } },
        { "outdoor_noon_167", { 0.4900139272212982, 0.6855142712593079, 0.5384761691093445 } },
        { "outdoor_noon_168", { 0.4788493812084198, 0.6838976740837097, 0.5504428744316101 } },
        { "outdoor_noon_169", { 0.46784350275993347, 0.6716473698616028, 0.5744670033454895 } },
        { "outdoor_noon_170", { 0.5065801739692688, 0.6991833448410034, 0.5044989585876465 } },
        { "outdoor_noon_171", { 0.5026445388793945, 0.7074338793754578, 0.496876060962677 } },
        { "outdoor_noon_172", { 0.4823225736618042, 0.6699925065040588, 0.5643358826637268 } },
        { "outdoor_noon_173", { 0.4771851897239685, 0.6680471301078796, 0.5709705352783203 } },
        { "outdoor_noon_174", { 0.4641362726688385, 0.6564332842826843, 0.5947040319442749 } },
        { "outdoor_noon_175", { 0.5097187757492065, 0.7044018507003784, 0.4939686059951782 } },
        { "outdoor_noon_176", { 0.5326583981513977, 0.732805609703064, 0.42340412735939026 } },
        { "outdoor_noon_177", { 0.5247206091880798, 0.7235337495803833, 0.44851669669151306 } },
        { "outdoor_noon_178", { 0.5108711123466492, 0.7111817002296448, 0.4829402565956116 } },
        { "outdoor_noon_179", { 0.49341392517089844, 0.6945860981941223, 0.5235387682914734 } },
        { "outdoor_noon_180", { 0.5052884817123413, 0.7226377725601196, 0.4716759920120239 } },
        { "outdoor_noon_181", { 0.4723285436630249, 0.6602645516395569, 0.5839147567749023 } },
        { "outdoor_noon_182", { 0.4897526800632477, 0.6680541038513184, 0.5602195858955383 } },
        { "outdoor_noon_183", { 0.48584187030792236, 0.6759160757064819, 0.5541616082191467 } },
        { "outdoor_noon_184", { 0.5156648755073547, 0.7130709886550903, 0.47499412298202515 } },
        { "outdoor_noon_185", { 0.48604074120521545, 0.6780859231948853, 0.5513291358947754 } },
        { "outdoor_noon_186", { 0.47865334153175354, 0.6545498371124268, 0.5851969718933105 } },
        { "outdoor_noon_187", { 0.48140808939933777, 0.6538785099983215, 0.5836857557296753 } },
        { "outdoor_noon_188", { 0.48815324902534485, 0.6774115562438965, 0.5502908229827881 } },
        { "outdoor_noon_189", { 0.4792490005493164, 0.650122880935669, 0.5896275043487549 } },
        { "outdoor_noon_190", { 0.47717052698135376, 0.6731591820716858, 0.5649469494819641 } },
        { "outdoor_noon_191", { 0.4836665093898773, 0.6637719869613647, 0.5705028176307678 } },
        { "outdoor_noon_192", { 0.4955785274505615, 0.6671321988105774, 0.5561802387237549 } },
        { "outdoor_noon_193", { 0.4738192856311798, 0.6631965637207031, 0.5793666243553162 } },
    };
    
    
    const Color<ColorSpace::Raw>& illum = C50Illuminants.at(path.filename().replace_extension());
    const size_t len = sizeof(uint16_t)*width*height;
    const Mmap imgMmap(path.c_str());
    
    // Verify that the file size is what we expect, given the image width/height
    if (imgMmap.len() != len) throw std::runtime_error("invalid length");
    
    // Create a Metal buffer, and copy the image contents into it
    Renderer::Buf imgBuf = renderer.createBuffer(len);
    memcpy([imgBuf contents], imgMmap.data(), len);
    
    Renderer::Txt raw = renderer.createTexture(MTLPixelFormatR32Float, width, height);
    
    // Load `raw`
    renderer.render("CFAViewer::Shader::ImagePipeline::LoadRaw", raw,
        // Buffer args
        CFADesc,
        width,
        height,
        imgBuf
        // Texture args
    );
    
    // Reconstruct highlights
    {
        const simd::float3 badPixelFactors = {1.130, 1.613, 1.000};
        const simd::float3 goodPixelFactors = {1.051, 1.544, 1.195};
        Renderer::Txt tmp = renderer.createTexture(MTLPixelFormatR32Float, width, height);
        renderer.render("CFAViewer::Shader::ImagePipeline::ReconstructHighlights", tmp,
            // Buffer args
            CFADesc,
            badPixelFactors,
            goodPixelFactors,
            // Texture args
            raw
        );
        raw = std::move(tmp);
    }
    
    // White balance
    {
        const simd::float3 whiteBalance = {
            (float)(illum[1]/illum[0]),
            (float)(illum[1]/illum[1]),
            (float)(illum[1]/illum[2])
        };
        renderer.render("CFAViewer::Shader::ImagePipeline::WhiteBalance", raw,
            // Buffer args
            CFADesc,
            whiteBalance,
            // Texture args
            raw
        );
    }
    
    // LMMSE Debayer
    Renderer::Txt rgb = renderer.createTexture(MTLPixelFormatRGBA32Float, width, height);
    {
        DebayerLMMSE::Run(renderer, CFADesc, false, raw, rgb);
    }
    
    // Camera raw -> ProPhotoRGB
    {
        const CCM ccm = CCMForIlluminant(illum);
        const simd::float3x3 ccmSIMD = SIMDFromMat(ccm.m);
        renderer.render("CFAViewer::Shader::ImagePipeline::ApplyColorMatrix", rgb,
            // Buffer args
            ccmSIMD,
            // Texture args
            rgb
        );
    }
    
    // ProPhotoRGB -> XYZ.D50
    {
        renderer.render("CFAViewer::Shader::ImagePipeline::XYZD50FromProPhotoRGB", rgb,
            // Texture args
            rgb
        );
    }
    
    // XYZ.D50 -> XYZ.D65
    {
        renderer.render("CFAViewer::Shader::ImagePipeline::BradfordXYZD65FromXYZD50", rgb,
            // Texture args
            rgb
        );
    }
    
    // XYZ.D65 -> LSRGB.D65
    {
        renderer.render("CFAViewer::Shader::ImagePipeline::LSRGBD65FromXYZD65", rgb,
            // Texture args
            rgb
        );
    }
    
    // Apply SRGB gamma
    {
        renderer.render("CFAViewer::Shader::ImagePipeline::SRGBGamma", rgb,
            // Texture args
            rgb
        );
    }
    
    // Final display render pass
    Renderer::Txt rgba16 = renderer.createTexture(MTLPixelFormatRGBA16Float,
        width, height, MTLTextureUsageRenderTarget|MTLTextureUsageShaderRead);
    renderer.render("CFAViewer::Shader::ImagePipeline::Display", rgba16,
        // Texture args
        rgb
    );
    
    renderer.sync(rgba16);
    renderer.commitAndWait();
    
    const fs::path pngPath = fs::path(path).replace_extension(".png");
    std::cout << pngPath << "\n";
    writePNG(rgba16, pngPath);
}

static bool isCFAFile(const fs::path& path) {
    return fs::is_regular_file(path) && path.extension() == ".cfa";
}

int main(int argc, const char* argv[]) {
//    printf("D55 CCT: %.1f K\n", CCTFromXYChromaticity(0.332424, 0.347426));
//    exit(0);
    
    const uint32_t Width = 2304;
    const uint32_t Height = 1296;
    
    Renderer renderer;
    {
        id<MTLDevice> dev = MTLCreateSystemDefaultDevice();
        assert(dev);
        
        auto metalLibPath = fs::path(argv[0]).replace_filename("default.metallib");
        id<MTLLibrary> lib = [dev newLibraryWithFile:@(metalLibPath.c_str()) error:nil];
        assert(lib);
        id<MTLCommandQueue> commandQueue = [dev newCommandQueue];
        assert(commandQueue);
        
        renderer = Renderer(dev, lib, commandQueue);
    }
    
    for (int i=1; i<argc; i++) {
        const char* pathArg = argv[i];
        
        // Regular file
        if (isCFAFile(pathArg)) {
            createPNGFromCFA(renderer, Width, Height, pathArg);
        
        // Directory
        } else if (fs::is_directory(pathArg)) {
            for (const auto& f : fs::directory_iterator(pathArg)) {
                if (isCFAFile(f)) {
                    createPNGFromCFA(renderer, Width, Height, f);
                }
            }
        }
    }
    
    return 0;
}
